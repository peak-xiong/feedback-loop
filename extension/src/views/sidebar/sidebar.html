<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../shared/design-system.css" />
    <style>
      /* ═══ Page-specific styles ═══ */
      body {
        padding: 16px;
        background-color: var(
          --md-sys-color-surface,
          var(--vscode-sideBar-background)
        );
      }

      .title {
        font-size: 22px;
        font-weight: 500;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--md-sys-color-on-surface);
        letter-spacing: 0.1px;
      }

      .title .material-symbols-outlined {
        font-size: 24px;
        color: var(--md-sys-color-primary);
      }

      .status-card {
        background: var(--md-sys-color-surface-container);
        border-radius: var(--md-sys-shape-corner-medium);
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: var(--md-sys-elevation-level1);
      }

      .status-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .status-row:last-child {
        margin-bottom: 0;
      }

      .label {
        color: var(--md-sys-color-on-surface-variant);
        font-size: 14px;
        font-weight: 400;
      }

      .value {
        font-size: 14px;
        font-weight: 500;
      }

      .value.running,
      .value.stopped {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .value.running {
        color: var(--md-sys-color-success);
      }

      .value.stopped {
        color: var(--md-sys-color-error);
      }

      /* Buttons override for full width */
      .btn {
        width: 100%;
        margin-top: 12px;
      }

      .section-title {
        font-size: 16px;
        font-weight: 500;
        margin: 24px 0 12px 0;
        color: var(--md-sys-color-on-surface);
        display: flex;
        justify-content: space-between;
        align-items: center;
        letter-spacing: 0.1px;
      }

      .section-title .icon-text {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title .material-symbols-outlined {
        font-size: 20px;
      }

      .refresh-btn {
        background: none;
        border: none;
        color: var(--md-sys-color-primary);
        cursor: pointer;
        font-size: 13px;
        padding: 4px 8px;
        border-radius: var(--md-sys-shape-corner-extra-small);
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .refresh-btn:hover {
        background: color-mix(
          in srgb,
          var(--md-sys-color-primary) 8%,
          transparent
        );
      }

      .refresh-btn .material-symbols-outlined {
        font-size: 16px;
      }

      .session-list {
        background: var(--md-sys-color-surface-container);
        border-radius: var(--md-sys-shape-corner-medium);
        max-height: 240px;
        overflow-y: auto;
        box-shadow: var(--md-sys-elevation-level1);
      }

      .session-item {
        padding: 12px 16px;
        border-bottom: 1px solid var(--md-sys-color-outline);
        display: flex;
        flex-direction: column;
        gap: 6px;
        transition: background-color 0.2s ease;
      }

      .session-item:hover {
        background: color-mix(
          in srgb,
          var(--md-sys-color-on-surface) 4%,
          transparent
        );
      }

      .session-item:last-child {
        border-bottom: none;
      }

      .session-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .session-id {
        font-family: "Roboto Mono", var(--vscode-editor-font-family, monospace);
        font-size: 12px;
        color: var(--md-sys-color-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 140px;
        font-weight: 500;
      }

      .session-status {
        font-size: 10px;
        padding: 3px 8px;
        border-radius: var(--md-sys-shape-corner-small);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .session-status.pending {
        background: var(--md-sys-color-surface-variant);
        color: var(--md-sys-color-on-surface-variant);
      }

      .session-status.completed {
        background: var(--md-sys-color-success);
        color: var(--md-sys-color-on-success);
      }

      .session-reason {
        font-size: 12px;
        color: var(--md-sys-color-on-surface-variant);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.4;
      }

      .session-actions {
        display: flex;
        gap: 12px;
        margin-top: 8px;
      }

      .action-btn {
        background: none;
        border: none;
        color: var(--md-sys-color-primary);
        cursor: pointer;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: var(--md-sys-shape-corner-extra-small);
        transition: all 0.2s ease;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .action-btn:hover {
        background: color-mix(
          in srgb,
          var(--md-sys-color-primary) 8%,
          transparent
        );
        transform: translateY(-1px);
      }

      .action-btn .material-symbols-outlined {
        font-size: 14px;
      }

      .empty-state {
        padding: 24px;
        text-align: center;
        color: var(--md-sys-color-on-surface-variant);
        font-size: 14px;
        font-weight: 400;
      }

      .info-box {
        margin-top: 16px;
      }
    </style>
  </head>
  <body>
    <div class="title">
      <span class="material-symbols-outlined">bolt</span>
      IO Util
    </div>

    <div class="status-card">
      <div class="status-row">
        <span class="label">Status</span>
        <span class="value {{STATUS_CLASS}}">
          <span class="status-indicator {{STATUS_CLASS}}"></span>
          {{STATUS_TEXT}}
        </span>
      </div>
      <div class="status-row">
        <span class="label">Sessions</span>
        <span class="value">{{REQUEST_COUNT}}</span>
      </div>
    </div>

    <button class="btn btn-primary icon-btn" onclick="openPanel()">
      <span class="material-symbols-outlined">assignment</span>
      Reopen
    </button>
    <button class="btn btn-secondary icon-btn" onclick="restart()">
      <span class="material-symbols-outlined">refresh</span>
      Restart
    </button>

    <div class="section-title">
      <span class="icon-text">
        <span class="material-symbols-outlined">folder_open</span>
        Sessions
      </span>
      <button class="refresh-btn" onclick="refreshSessions()">
        <span class="material-symbols-outlined">refresh</span>
        Refresh
      </button>
    </div>

    <div class="session-list" id="sessionList">{{SESSIONS_HTML}}</div>

    <div class="info-box">
      <strong>Tip:</strong> AI 执行 CLI 命令后会自动弹出对话框。点击 "Reopen
      Panel" 重新打开上次请求。
    </div>

    <script>
      const vscode = acquireVsCodeApi();

      function openPanel() {
        vscode.postMessage({ command: "openPanel" });
      }

      function restart() {
        vscode.postMessage({ command: "restart" });
      }

      function refreshSessions() {
        vscode.postMessage({ command: "refreshSessions" });
      }

      function reopenSession(requestId) {
        vscode.postMessage({ command: "reopenSession", requestId: requestId });
      }

      function deleteSession(requestId) {
        vscode.postMessage({ command: "deleteSession", requestId: requestId });
      }
    </script>
  </body>
</html>
