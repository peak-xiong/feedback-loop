# Checkpoint 工具调用协议

## ⚠️ 最重要规则

**每次回复结束前，必须调用 `checkpoint` 工具。这是强制性要求，没有任何例外。**

不调用 `checkpoint` 就结束回复是严重错误，将导致用户无法继续与你对话。

## 必须调用的时机

1. **对话开始** - 用户发送第一条消息后
2. **回复用户后** - 任何回复内容之后（这是最重要的！）
3. **任务完成** - 代码修改、文件操作完成后
4. **用户结束语** - 用户说"谢谢"、"好的"时
5. **提问后** - 向用户提问后

## checkpoint 工具调用规范

### 必填参数
```json
{
  "reason": "简要说明当前状态或等待用户做什么",
  "context": "当前任务的简短描述（如：修复登录、添加功能）"
}
```

### 推荐使用 options（快捷回复按钮）
```json
{
  "reason": "任务已完成，请查看修改",
  "context": "Web3开发",
  "options": ["继续", "修改", "完成"]
}
```

**常用 options 组合：**
- 任务完成：`["继续", "修改", "完成"]`
- 需要确认：`["是", "否", "取消"]`
- 需要选择：`["方案A", "方案B", "都不要"]`
- 询问后续：`["继续开发", "切换任务", "暂停"]`

## 其他工具

### hold (无限暂停)
```json
{
  "reason": "等待用户审核"
}
```
用途：无限期等待用户恢复，不消耗额外积分。

### agent_start (创建身份)
```json
{
  "context": "任务描述",
  "model": "Claude Sonnet",
  "credits_spent": 5
}
```
用途：创建 agent 身份，便于后续恢复会话。

**CLI 调用命令**（所有参数都支持简写）：
```bash
cd /path/to/session-helper/feedback && uv run feedback \
  -p "项目目录" \
  -s "工作摘要" \
  -i "会话ID" \
  -m "模型名称" \
  -t "对话标题" \
  -o "继续,修改,完成"
```

### agent_find (查找历史)
```json
{
  "hints": "关键词"
}
```
用途：查找之前的 agent 会话。

## ❌ 禁止行为

- ❌ 不调用 checkpoint 就结束回复
- ❌ 假设用户没有更多需求
- ❌ 不使用 options 参数（应提供快捷选项）
- ❌ 不传递 context 参数（应说明当前任务）
- ❌ 以任何理由忽略此规则

## ✅ 正确示例

```
用户: 帮我修复登录bug

AI: [分析问题、修改代码...]
    我已经修复了登录问题，主要修改了...

    [调用 checkpoint 工具]
    {
      "reason": "登录bug已修复，请测试",
      "context": "修复登录bug",
      "options": ["测试通过", "还有问题", "下一个任务"]
    }
```


